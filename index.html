<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨åˆ†é˜åˆ¶å‡ºå‹¤ç®¡ç†ç³»çµ±</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #27ae60; /* æ”¹ç‚ºç¶ è‰²ç³»,ä»£è¡¨æ™‚é–“ç®¡ç† */
            --bg-color: #eef2f3;
            --card-bg: #ffffff;
            --text-color: #333;
            --alert-red: #c0392b;
            --alert-yellow: #f39c12;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            background-color: var(--card-bg);
            width: 100%;
            max-width: 800px;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }

        h1 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 5px;
            font-size: 26px;
        }

        .subtitle {
            text-align: center;
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 30px;
        }

        /* è¼¸å…¥å€ä½ˆå±€ */
        .input-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border: 1px solid #e1e4e8;
        }

        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
            color: #2c3e50;
        }

        input {
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
            outline: none;
        }

        .hint {
            font-size: 12px;
            color: #95a5a6;
            margin-top: 5px;
        }

        /* æŒ‰éˆ• */
        button {
            width: 100%;
            padding: 16px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 18px;
            cursor: pointer;
            font-weight: bold;
            letter-spacing: 1px;
            transition: background-color 0.3s, transform 0.1s;
        }

        button:hover {
            background-color: #34495e;
            transform: translateY(-2px);
        }

        /* çµæœå±•ç¤ºå€ */
        #resultsSection {
            margin-top: 30px;
            display: none;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--primary-color);
            border-left: 4px solid var(--accent-color);
            padding-left: 10px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .result-card {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #eee;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }

        .result-card h3 {
            margin: 0 0 10px 0;
            font-size: 13px;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-value {
            font-size: 28px;
            font-weight: 800;
            color: var(--primary-color);
        }
        
        .unit {
            font-size: 14px;
            font-weight: normal;
            color: #95a5a6;
            margin-left: 2px;
        }

        .sub-value {
            font-size: 13px;
            color: #7f8c8d;
            margin-top: 5px;
        }

        /* è­¦å‘Šæ¡† */
        .alert-box {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
            font-weight: bold;
            line-height: 1.6;
            font-size: 15px;
        }

        .alert-error {
            background-color: #fadbd8;
            color: #922b21;
            border-left: 5px solid var(--alert-red);
        }

        .alert-warning {
            background-color: #fcf3cf;
            color: #9a7d0a;
            border-left: 5px solid var(--alert-yellow);
        }

        @media (max-width: 600px) {
            .input-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>â³ å…¨åˆ†é˜åˆ¶å‡ºå‹¤è¨ˆç®—å™¨</h1>
    <p class="subtitle">å°‡ç¼ºå¸­èˆ‡é²åˆ°çµ±ä¸€è½‰æ›ç‚ºåˆ†é˜é€²è¡Œç²¾ç¢ºè¨ˆç®—</p>

    <div id="inputErrorBox" class="alert-box alert-error"></div>

    <div class="input-section">
        <div class="input-grid">
            <div class="form-group">
                <label for="totalClasses">ç¸½èª²å ‚æ•¸</label>
                <input type="number" id="totalClasses" placeholder="ä¾‹: 13" min="1">
            </div>
            
            <div class="form-group">
                <label for="classDuration">å–®å ‚æ™‚é•· (åˆ†é˜)</label>
                <input type="number" id="classDuration" placeholder="ä¾‹: 60" min="1">
            </div>

            <div class="form-group">
                <label for="maxAbsenceRate">æœ€å¤§å…è¨±ç¼ºå¸­ç‡ (%)</label>
                <input type="number" id="maxAbsenceRate" placeholder="ä¾‹: 20" min="0" max="100">
                <span class="hint">èª²ç¨‹è¦å®šçš„æ‰£è€ƒç·š</span>
            </div>

            <div class="form-group">
                <label for="classesHeld">å·²é€²è¡Œå ‚æ•¸ (ç”¨æ–¼é©—è­‰)</label>
                <input type="number" id="classesHeld" placeholder="ä¾‹: 5" min="0">
            </div>

            <div class="form-group">
                <label for="actualAbsences">å·²ç¼ºå¸­å ‚æ•¸</label>
                <input type="number" id="actualAbsences" placeholder="ä¾‹: 1" min="0">
            </div>

            <div class="form-group">
                <label for="totalLateness">å·²é²åˆ°ç¸½åˆ†é˜æ•¸</label>
                <input type="number" id="totalLateness" placeholder="ä¾‹: 15" min="0" value="0">
            </div>
        </div>
    </div>

    <button onclick="calculateResults()">è¨ˆ ç®— ç‹€ æ…‹</button>

    <div id="resultsSection">
        
        <div id="resultAlertBox" class="alert-box"></div>

        <div class="section-title">æ ¸å¿ƒæŒ‡æ¨™ (åŸºæ–¼å…¨èª²ç¨‹)</div>
        <div class="dashboard-grid">
            <div class="result-card">
                <h3>é æœŸæœ€çµ‚å‡ºå¸­ç‡</h3>
                <div class="result-value" id="resAttRate">--</div>
                <div class="sub-value">è‹¥å…¨å‹¤å‰©é¤˜èª²ç¨‹</div>
            </div>
            <div class="result-card">
                <h3>ç›®å‰ç¸½æ¶ˆè€—ç‡</h3>
                <div class="result-value" id="resAbsRate">--</div>
                <div class="sub-value">ç¼ºå¸­ + é²åˆ°æŠ˜ç®—</div>
            </div>
        </div>

        <div class="section-title">æ™‚é–“éŠ€è¡Œ (Time Budget)</div>
        <div class="dashboard-grid">
            <div class="result-card">
                <h3>ç¸½å…è¨±ç¼ºå¸­æ™‚é–“</h3>
                <div class="result-value" id="resMaxTime">--</div>
            </div>
            <div class="result-card">
                <h3>å·²æ¶ˆè€—æ™‚é–“</h3>
                <div class="result-value" id="resConsumedTime">--</div>
                <div class="sub-value" id="resConsumedDetail"></div>
            </div>
            <div class="result-card" style="border-color: var(--accent-color); background-color: #f0fdf4;">
                <h3>å°šé¤˜ç·©è¡æ™‚é–“</h3>
                <div class="result-value" id="resBufferTime">--</div>
                <div class="sub-value" id="resBufferClasses"></div>
            </div>
        </div>
    </div>
</div>

<script>
    function calculateResults() {
        // --- 1. ç²å–è¼¸å…¥ ---
        const totalClasses = parseInt(document.getElementById('totalClasses').value);
        const classDuration = parseFloat(document.getElementById('classDuration').value);
        const classesHeld = parseInt(document.getElementById('classesHeld').value);
        const maxAbsenceRate = parseFloat(document.getElementById('maxAbsenceRate').value);
        const actualAbsences = parseInt(document.getElementById('actualAbsences').value) || 0;
        const totalLateness = parseFloat(document.getElementById('totalLateness').value) || 0;

        // UI å…ƒç´ 
        const inputErrorBox = document.getElementById('inputErrorBox');
        const resultsSection = document.getElementById('resultsSection');
        const resultAlertBox = document.getElementById('resultAlertBox');

        // é‡ç½®
        inputErrorBox.style.display = 'none';
        resultsSection.style.display = 'none';
        resultAlertBox.style.display = 'none';
        resultAlertBox.className = 'alert-box'; 

        // --- 2. é©—è­‰æ•¸æ“š ---
        let errorMessage = "";
        if (!totalClasses || !classDuration || isNaN(classesHeld) || isNaN(maxAbsenceRate)) {
            errorMessage = "è«‹å¡«å¯«æ‰€æœ‰å¿…è¦æ¬„ä½ã€‚";
        } else if (classesHeld > totalClasses) {
            errorMessage = "éŒ¯èª¤:å·²é€²è¡Œå ‚æ•¸ä¸èƒ½è¶…éç¸½å ‚æ•¸ã€‚";
        } else if (actualAbsences > classesHeld) {
            errorMessage = "éŒ¯èª¤:å·²ç¼ºå¸­å ‚æ•¸ä¸èƒ½è¶…éå·²é€²è¡Œå ‚æ•¸ã€‚";
        }

        if (errorMessage) {
            inputErrorBox.textContent = errorMessage;
            inputErrorBox.style.display = 'block';
            return;
        }

        // --- 3. æ ¸å¿ƒé‚è¼¯ (å…¨åˆ†é˜åˆ¶) ---

        // 3.1 åŸºç¤æ•¸æ“š
        const totalCourseTime = totalClasses * classDuration; // èª²ç¨‹ç¸½åˆ†é˜æ•¸
        
        // 3.2 æ™‚é–“éŠ€è¡Œ (ç¸½å…±å…è¨±éŒ¯éå¤šå°‘åˆ†é˜)
        // ä½¿ç”¨ floor ç¢ºä¿ä¸å› ç‚ºå°æ•¸é»èª¤å·®å°è‡´çœ‹èµ·ä¾†å¯ä»¥å¤šç¼ºèª²
        const maxAllowedTime = Math.floor(totalCourseTime * (maxAbsenceRate / 100));

        // 3.3 å·²æ¶ˆè€—æ™‚é–“ (ç¼ºå¸­å ‚æ•¸è½‰åˆ†é˜ + é²åˆ°åˆ†é˜)
        const absenceTimeConsumed = actualAbsences * classDuration;
        const totalConsumedTime = absenceTimeConsumed + totalLateness;

        // 3.4 å°šé¤˜ç·©è¡æ™‚é–“ (Remaining Buffer)
        const remainingBufferTime = maxAllowedTime - totalConsumedTime;

        // 3.5 è¨ˆç®—æ¯”ç‡ (Rates)
        // ç¼ºå¸­ç‡ = å·²æ¶ˆè€—æ™‚é–“ / ç¸½èª²ç¨‹æ™‚é–“ (é€™æ¨£æŠŠé²åˆ°ä¹Ÿç®—é€²ç¼ºå¸­ç‡,æ›´åš´æ ¼æº–ç¢º)
        const currentAbsRate = (totalConsumedTime / totalCourseTime) * 100;
        
        // å‡ºå¸­ç‡ = 100% - ç¼ºå¸­ç‡
        let projectedAttRate = 100 - currentAbsRate;
        if (projectedAttRate < 0) projectedAttRate = 0;

        // è¼”åŠ©æ•¸æ“š:å‰©é¤˜æ™‚é–“ç­‰æ–¼å¹¾å ‚èª²
        const remainingBufferClasses = (remainingBufferTime / classDuration).toFixed(1);

        // --- 4. æ›´æ–° UI ---
        
        document.getElementById('resAttRate').textContent = projectedAttRate.toFixed(1) + '%';
        document.getElementById('resAbsRate').textContent = currentAbsRate.toFixed(1) + '%';

        document.getElementById('resMaxTime').innerHTML = maxAllowedTime + '<span class="unit">åˆ†é˜</span>';
        
        document.getElementById('resConsumedTime').innerHTML = totalConsumedTime + '<span class="unit">åˆ†é˜</span>';
        document.getElementById('resConsumedDetail').textContent = `(ç¼ºå¸­ ${actualAbsences} å ‚ + é²åˆ° ${totalLateness} åˆ†)`;

        document.getElementById('resBufferTime').innerHTML = remainingBufferTime + '<span class="unit">åˆ†é˜</span>';
        document.getElementById('resBufferClasses').textContent = `ç´„ç­‰æ–¼ ${remainingBufferClasses} å ‚èª²`;

        // é¡è‰²é‚è¼¯:å¦‚æœå‰©é¤˜æ™‚é–“æ˜¯è² çš„,è®Šç´…è‰²
        const bufferElement = document.getElementById('resBufferTime').parentElement;
        if (remainingBufferTime < 0) {
            bufferElement.style.backgroundColor = '#fadbd8';
            bufferElement.style.borderColor = '#e74c3c';
            document.getElementById('resBufferTime').style.color = '#c0392b';
        } else {
            bufferElement.style.backgroundColor = '#f0fdf4';
            bufferElement.style.borderColor = '#27ae60';
            document.getElementById('resBufferTime').style.color = '#2c3e50';
        }

        resultsSection.style.display = 'block';

        // --- 5. è­¦å‘Šç³»çµ± ---
        let alertMsg = "";
        let isCritical = false;

        // åš´æ ¼æª¢æŸ¥:åªè¦å‰©é¤˜æ™‚é–“å°æ–¼ 0 å°±æ˜¯è¶…é™
        if (remainingBufferTime < 0) {
            const overTime = Math.abs(remainingBufferTime);
            alertMsg += `âš ï¸ <b>å±éšª!</b> æ‚¨çš„ç¼ºå¸­/é²åˆ°ç¸½æ™‚æ•¸å·²è¶…éä¸Šé™!<br>å·²è¶…æ¨™ <b>${overTime} åˆ†é˜</b>ã€‚é€™å¯èƒ½å°è‡´è©²ç§‘ç›®ä¸åŠæ ¼ (F)ã€‚<br>`;
            isCritical = true;
        } else if (remainingBufferTime < classDuration && remainingBufferTime > 0) {
            alertMsg += `ğŸ”” <b>æé†’:</b> æ‚¨çš„ç·©è¡æ™‚é–“åªå‰©ä¸‹ <b>${remainingBufferTime} åˆ†é˜</b> (ä¸è¶³ä¸€å ‚èª²)ã€‚<br>è«‹é¿å…å†æœ‰ä»»ä½•é²åˆ°æˆ–ç¼ºå¸­ã€‚`;
        } else if (remainingBufferTime === 0) {
             alertMsg += `âš ï¸ <b>è‡¨ç•Œé»:</b> æ‚¨å·²ç”¨ç›¡æ‰€æœ‰ç¼ºå¸­é¡åº¦ (0 åˆ†é˜å‰©é¤˜)ã€‚<br>ä¸‹æ¬¡é²åˆ° 1 åˆ†é˜å³æœƒè¶…æ¨™ã€‚`;
             isCritical = true; // è¨­ç‚º critical å¼•èµ·æ³¨æ„
        }

        if (alertMsg) {
            resultAlertBox.innerHTML = alertMsg;
            resultAlertBox.style.display = 'block';
            if (isCritical) {
                resultAlertBox.classList.add('alert-error');
                resultAlertBox.classList.remove('alert-warning');
            } else {
                resultAlertBox.classList.add('alert-warning');
                resultAlertBox.classList.remove('alert-error');
            }
        }
    }
</script>

</body>
</html>
